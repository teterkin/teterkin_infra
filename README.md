# teterkin_infra

## Подключение к someinternalhost в одну команду

Для подключения к узлу, находящимся за бастионом достаточно выполнить одну
команду:

```bash

$ ssh -A BASTION-IP -t ssh INTERNAL-HOST

```

Вместо `BASTION-IP` укажите публичный IP адрес вашего бастион сервера.

Вместо `INTERNAL-HOST` укажите внутренний IP адрес сервера во внутреннем
периметре.

## Подключение к someinternalhost с помощью короткой команды

> Команды вида ssh someinternalhost

Для подключения из консоли при помощи команды вида `ssh someinternalhost` из
локальной консоли рабочего устройства, необходимо выполнить ряд действий, чтобы
настроить локальный алиас `someinternalhost` в локальном конфигурационном файле
клиента ssh:

1. Создайте локальный конфигурационный файл ssh и назначьте файлу права доступа:

   ```bash
   $ touch ~/.ssh/config
   $ chmod 0700 ~/.ssh/config
   ```

1. Откройте файл в редакторе `vi`:

   ```bash
   $ vi ~/.ssh/config
   ```

1. Опишите секцию отосящуюся к нашему серверу:

   ```ini
   Host someinternalhost
        HostName INTERNAL-HOST
        Port 22
        ForwardX11 no
        ProxyJump BASTION-IP
   ```
  
   Где, как в примере выше, Вместо `BASTION-IP` укажите публичный IP адрес
   вашего бастион сервера, а вместо `INTERNAL-HOST` укажите внутренний IP адрес
   сервера во внутреннем периметре.

1. Сохраните файл.
1. Проверьте подключение. Теперь для подключения к внутреннему серверу через
   бастион достаточно набрать:

   ```bash
   $ ssh someinternalhost
   ```

## Настройка VPN

Для настройки VPN используйте файл [setupvpn.sh](./setupvpn.sh).

Для доступа к моему настроенному серверу используйте клиента OpenVPN и файл
профиля [cloud-bastion.ovpn](./cloud-bastion.ovpn).

Временные IP адреса для проверки конфигурации:

bastion_IP = 35.246.197.77

someinternalhost_IP = 10.156.0.3
